<!DOCTYPE html>
<html>

<head>
    <title>Contoh Penggunaan Polygon dengan Google Maps</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY"></script>
    <!-- <script src="C:\Users\Anan\Desktop\Make Dashboard NJOP\output.js"></script> -->
    <script src="C:\Users\Anan\Desktop\Make Dashboard NJOP\Village_Aceh.js"></script>
    <!-- <script src="C:\Users\Anan\Desktop\Make Dashboard NJOP\Village_Bali.js"></script> -->
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <script>
        var map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: -6.2088, lng: 106.8456 },
                zoom: 12
            });

            var geojsonData = {
                "type": "FeatureCollection",
                "features": [
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": []
                        },
                        "properties": {
                            "province": "",
                            "district": "",
                            "sub_district": "",
                            "village": ""
                        }
                    }
                ]
            }

            var features = geojsonData.features;
            var geoJSON = [];
            var results = [];

            var startColor = [255, 0, 0];
            var endColor = [124, 0, 0];

            function interpolateColor(startColor, endColor, value) {
                var r = Math.round(startColor[0] + (endColor[0] - startColor[0]) * value);
                var g = Math.round(startColor[1] + (endColor[1] - startColor[1]) * value);
                var b = Math.round(startColor[2] + (endColor[2] - startColor[2]) * value);
                return 'rgb(' + r + ',' + g + ',' + b + ')';
            }

            function changeColor(dataValue) {
                var interpolationValue = (dataValue - 1) / (6498 - 1);
                var textColor = interpolateColor(startColor, endColor, interpolationValue);
                return textColor
            }

            for (var i = 0; i < data.length; i++) {
                var feature = data[i];

                var province = data[i].province;
                var district = data[i].district;
                var sub_district = data[i].sub_district;
                var village = data[i].village;
                var coordinates = data[i].border;
                var population = i;

                var fillColorRGB = changeColor(population);

                results.push({
                    type: "Feature",
                    geometry: {
                        type: "Polygon",
                        coordinates: [JSON.parse(coordinates)]
                    },
                    properties: {
                        province: province,
                        district: district,
                        sub_district: sub_district,
                        village: village,
                        population: population,
                        fillColor: fillColorRGB
                    }
                });
            }

            geoJSON.type = "FeatureCollection";
            geoJSON.features = results;

            var legend = document.createElement('div');
            legend.id = 'legend';
            legend.style.backgroundColor = '#fff';
            legend.style.padding = '10px';
            legend.style.borderRadius = '5px';
            legend.style.boxShadow = '0 0 10px rgba(0, 0, 0, 0.1)';
            legend.style.position = 'absolute';
            legend.style.top = '20px';
            legend.style.right = '20px';
            legend.style.zIndex = '1000';

            // Add legend title
            var legendTitle = document.createElement('div');
            legendTitle.innerHTML = '<h4>Legend</h4>';
            legend.appendChild(legendTitle);


            geoJSON.features.forEach(function (feature) {
                var coordinates = feature.geometry.coordinates[0].map(function (coord) {
                    if (typeof coord[0] !== 'number' || typeof coord[1] !== 'number' || isNaN(coord[0]) || isNaN(coord[1])) {
                        return { lat: 0, lng: 0 };
                    }
                    return { lat: coord[1], lng: coord[0] };
                });

                var polygon = new google.maps.Polygon({
                    paths: coordinates,
                    strokeColor: '#f3f6f4',
                    fillColor: feature.properties.fillColor,
                    fillOpacity: 100
                });

                var bounds = new google.maps.LatLngBounds();
                polygon.getPath().forEach(function (point) {
                    bounds.extend(point);
                });
                var centerPosition = bounds.getCenter();

                if (centerPosition.lat() !== 0) {
                    var infoWindow = new google.maps.InfoWindow({
                        ariaLabel: "Uluru",
                        content: feature.properties.village
                    });

                    google.maps.event.addListener(polygon, 'click', function (event) {
                        infoWindow.setPosition(event.latLng);
                        infoWindow.open(map);
                    });
                }
                polygon.setMap(map);

                var villageName = feature.properties.village;

                var legendItem = document.createElement('div');
                legendItem.innerHTML = '<span style="background-color:' + feature.properties.fillColor + ';width:20px;height:20px;display:inline-block;margin-right:5px;"></span>' + villageName;
                // legend.appendChild(legendItem);
            });

            map.controls[google.maps.ControlPosition.RIGHT_TOP].push(legend);
        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY">
    </script>
</body>

</html>